(this["webpackJsonpreviews-front"]=this["webpackJsonpreviews-front"]||[]).push([[0],{102:function(e,t,r){},105:function(e,t,r){},126:function(e,t,r){},127:function(e,t,r){},129:function(e,t,r){"use strict";r.r(t);var n,a=r(2),c=r.n(a),s=r(28),i=r.n(s),o=(r(97),function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,143)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;r(e),n(e),a(e),c(e),s(e)}))}),u=r(24),l=r(15),d=r(16),j=r(133),b=r(134),v=r(76),h=r(142),x=r(135),p=r(136),O=r(18),f=r(71),m=r(1),g=function(e){var t=e.className,r=e.title,n=e.onClick,a=e.children;return Object(m.jsxs)("div",{onClick:n,className:"Page ".concat(null!==t&&void 0!==t?t:""),children:[Object(m.jsx)(f.a,{children:Object(m.jsx)("title",{children:r?"Reviews - ".concat(r):"Reviews"})}),a]})},k=(r(102),""),w=r(19),E=c.a.createContext({token:void 0,setToken:function(){}}),y=function(){return Object(a.useContext)(E)},N=function(e){var t=e.children,r=E.Provider,n=Object(a.useMemo)((function(){return localStorage.getItem("token")||void 0}),[]),c=Object(a.useState)(n),s=Object(w.a)(c,2),i=s[0],o=s[1],u=Object(a.useCallback)((function(e){e?localStorage.setItem("token",e):localStorage.removeItem("token"),o(e)}),[]),d=Object(a.useMemo)((function(){return{token:i,setToken:u}}),[i,u]),j=Object(l.useQueryClient)();return Object(a.useEffect)((function(){void 0===i&&j.clear()}),[j,i]),Object(m.jsx)(r,{value:d,children:t})},C=function(e){var t=e.visible,r=e.redirectUrl,n=e.children;return t?Object(m.jsx)(m.Fragment,{children:n}):void 0!==r?Object(m.jsx)(d.a,{to:r}):null},I=function(e){var t=e.redirectUrl,r=e.children,n=y().token;return Object(m.jsx)(C,{visible:void 0===n,redirectUrl:t,children:r})},A=Object(O.cn)("SignInPage"),T=function(e){var t=e.classname;return Object(m.jsx)(I,{redirectUrl:"/",children:Object(m.jsx)(g,{className:A(null,[t]),title:"Sign in",children:Object(m.jsx)(j.a,{children:Object(m.jsx)(b.a,{className:"d-flex align-items-center",children:Object(m.jsx)(v.a,{md:{span:4,offset:4},children:Object(m.jsxs)(h.a,{children:[Object(m.jsx)(h.a.Header,{children:"Sign in with"}),Object(m.jsxs)(h.a.Text,{className:"d-grid gap-2 p-2",children:[Object(m.jsxs)(x.a,{href:"".concat(k,"/oauth2/authorization/github"),variant:"outline-dark",children:[Object(m.jsx)("span",{className:"align-middle",children:"GitHub"})," ",Object(m.jsx)(p.b,{})]}),Object(m.jsxs)(x.a,{href:"".concat(k,"/oauth2/authorization/facebook"),variant:"outline-dark",children:[Object(m.jsx)("span",{className:"align-middle",children:"Facebook"}),Object(m.jsx)(p.a,{})]}),Object(m.jsxs)(x.a,{href:"".concat(k,"/oauth2/authorization/google"),variant:"outline-dark",children:[Object(m.jsx)("span",{className:"align-middle",children:"Google"})," ",Object(m.jsx)(p.c,{})]})]})]})})})})})})},D=r(137),R=(r(105),r(3)),G=r(77),U=r(78),L=r(79),S=r(83),Q=r(84);!function(e){e.NEED_AUTH="\u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u0430 \u0430\u0443\u0442\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u044f"}(n||(n={}));var P,V=function(e){Object(L.a)(r,e);var t=Object(S.a)(r);function r(e,n){var a;return Object(G.a)(this,r),(a=t.call(this)).type=e,a.msg=n,a}return Object(U.a)(r,null,[{key:"typed",value:function(e){return new r(e,e)}}]),r}(Object(Q.a)(Error)),W=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=y(),c=a.token,s=a.setToken;return Object(l.useQuery)(e,t(c),Object(R.a)(Object(R.a)({retry:!1},r),{},{onError:function(e){e instanceof V&&e.type===n.NEED_AUTH&&s(void 0),r.onError&&r.onError(e)}}))};!function(e){e.ME="me",e.REVIEW="review",e.REVIEWS="reviews",e.CATEGORIES="categories",e.FOUND_REVIEWS="found_reviews"}(P||(P={}));var F=new l.QueryClient,_=r(6),B=r.n(_),H=r(11);function M(e,t){for(var r=function(){var r=a[n];if(!(r in e))return{v:!1};var c=t[r];return c?(Array.isArray(c)?c:[c]).some((function(t){return typeof e[r]===t}))?void 0:{v:!1}:"continue"},n=0,a=Object.keys(t);n<a.length;n++){var c=r();if("continue"!==c&&"object"===typeof c)return c.v}return!0}var z,Y=function(e,t){return!!Array.isArray(e)&&e.every(t)},J=function(e){return"string"===typeof e},q=function(e){return"object"===typeof e&&null!==e&&(!!M(e,{id:"number",author:"object",tittle:"string",content:"string",grade:"number",categories:"object",likesCount:"number",usersGradesAvg:["object","number"],tagsNames:"object",imagesUrls:"object"})&&((null===e.usersGradesAvg||"number"===typeof e.usersGradesAvg)&&(!!Y(e.categories,J)&&(!!Y(e.tagsNames,J)&&(!!Y(e.imagesUrls,J)&&!("object"!==typeof(t=e.author)||null===t||!M(t,{id:"number",username:"string",provider:"string"})))))));var t},K=r(14),X=r.n(K),Z=function(e){return Object(H.a)(B.a.mark((function t(){var r,a,c;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,X.a.get("".concat(k,"/api/reviews"),{headers:{Authorization:"Bearer ".concat(e)}});case 5:if(r=t.sent,a=r.data,!Y(a,q)){t.next=9;break}return t.abrupt("return",a);case 9:t.next=17;break;case 11:if(t.prev=11,t.t0=t.catch(2),!X.a.isAxiosError(t.t0)){t.next=17;break}if(403!==(null===(c=t.t0.response)||void 0===c?void 0:c.status)){t.next=16;break}throw V.typed(n.NEED_AUTH);case 16:throw t.t0;case 17:throw new Error;case 18:case"end":return t.stop()}}),t,null,[[2,11]])})))},$=function(e){return function(){var t=Object(H.a)(B.a.mark((function t(r){var a,c,s,i;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,(a=new FormData).append("id",r.id.toString()),a.append("tittle",r.tittle),a.append("content",r.content),a.append("grade",r.grade.toString()),r.categories.forEach((function(e){return a.append("categories",e)})),r.tagsNames.forEach((function(e){return a.append("tagsNames",e)})),r.images.forEach((function(e){return a.append("images",e,e.name)})),t.next=13,X.a.put("".concat(k,"/api/reviews/").concat(r.id),a,{headers:{Authorization:"Bearer ".concat(e)}});case 13:if(c=t.sent,s=c.data,!q(s)){t.next=17;break}return t.abrupt("return",s);case 17:t.next=25;break;case 19:if(t.prev=19,t.t0=t.catch(2),!X.a.isAxiosError(t.t0)){t.next=25;break}if(403!==(null===(i=t.t0.response)||void 0===i?void 0:i.status)){t.next=24;break}throw V.typed(n.NEED_AUTH);case 24:throw t.t0;case 25:case"end":return t.stop()}}),t,null,[[2,19]])})));return function(e){return t.apply(this,arguments)}}()},ee=function(e){return function(){var t=Object(H.a)(B.a.mark((function t(r){var a,c,s,i;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,(a=new FormData).append("tittle",r.tittle),a.append("content",r.content),a.append("grade",r.grade.toString()),r.categories.forEach((function(e){return a.append("categories",e)})),r.tagsNames.forEach((function(e){return a.append("tagsNames",e)})),r.images.forEach((function(e){return a.append("images",e,e.name)})),t.next=12,X.a.post("".concat(k,"/api/reviews"),a,{headers:{Authorization:"Bearer ".concat(e)}});case 12:if(c=t.sent,s=c.data,!q(s)){t.next=16;break}return t.abrupt("return",s);case 16:t.next=24;break;case 18:if(t.prev=18,t.t0=t.catch(2),!X.a.isAxiosError(t.t0)){t.next=24;break}if(403!==(null===(i=t.t0.response)||void 0===i?void 0:i.status)){t.next=23;break}throw V.typed(n.NEED_AUTH);case 23:throw t.t0;case 24:case"end":return t.stop()}}),t,null,[[2,18]])})));return function(e){return t.apply(this,arguments)}}()},te=function(e){return function(){var t=Object(H.a)(B.a.mark((function t(r){var a,c,s;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,X.a.delete("".concat(k,"/api/reviews/").concat(r),{headers:{Authorization:"Bearer ".concat(e)}});case 5:if(a=t.sent,"number"!==typeof(c=a.data)){t.next=9;break}return t.abrupt("return",c);case 9:t.next=17;break;case 11:if(t.prev=11,t.t0=t.catch(2),!X.a.isAxiosError(t.t0)){t.next=17;break}if(403!==(null===(s=t.t0.response)||void 0===s?void 0:s.status)){t.next=16;break}throw V.typed(n.NEED_AUTH);case 16:throw t.t0;case 17:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}()},re=r(138),ne=r(141),ae=function(e){return Object(H.a)(B.a.mark((function t(){var r,a,c;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,X.a.get("".concat(k,"/api/users/me"),{headers:{Authorization:"Bearer ".concat(e)}});case 5:if(r=t.sent,a=r.data,"object"!==typeof(s=a)||null===s||!M(s,{id:"number",username:"string",provider:"string",reviews:"object"})||!Y(s.reviews,q)){t.next=9;break}return t.abrupt("return",a);case 9:t.next=17;break;case 11:if(t.prev=11,t.t0=t.catch(2),!X.a.isAxiosError(t.t0)){t.next=17;break}if(403!==(null===(c=t.t0.response)||void 0===c?void 0:c.status)){t.next=16;break}throw V.typed(n.NEED_AUTH);case 16:throw t.t0;case 17:throw new Error;case 18:case"end":return t.stop()}var s}),t,null,[[2,11]])})))},ce=function(){var e=W(P.ME,ae,{staleTime:1/0});return{me:e.data,isLoading:e.isLoading}},se=(r(126),Object(O.cn)("GlobalLayout")),ie=function(e){var t=e.className,r=e.children,n=Object(d.g)(),c=Object(d.i)().text,s=Object(l.useQueryClient)(),i=ce().me,o=Object(a.useCallback)((function(){n.push("/me")}),[n]),u=Object(a.useCallback)((function(){n.push("/signIn")}),[n]),h=Object(a.useCallback)((function(){n.push("/")}),[n]),p=Object(a.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(t){var r,a;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),r=t.currentTarget.elements,a=r.namedItem("searchingText").value,e.next=5,s.resetQueries(P.FOUND_REVIEWS);case 5:n.push("/reviews/search/result/".concat(encodeURIComponent(a)));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n,s]);return Object(m.jsxs)(j.a,{className:se(null,[t]),children:[Object(m.jsxs)(b.a,{className:"align-items-baseline",children:[Object(m.jsx)(v.a,{className:se("Top"),md:{span:2,offset:0},onClick:h,children:Object(m.jsx)("b",{children:"Reviews"})}),i?Object(m.jsx)(v.a,{className:se("Top"),md:{span:2,offset:8},onClick:o,children:i.username}):Object(m.jsx)(v.a,{className:se("Top"),md:{span:1,offset:9},onClick:o,children:Object(m.jsx)("div",{onClick:u,children:"authenticate"})})]}),Object(m.jsx)(b.a,{children:Object(m.jsx)(ne.a,{onSubmit:p,children:Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"searchingText",children:[Object(m.jsx)(ne.a.Label,{children:"search reviews"}),Object(m.jsxs)(b.a,{children:[Object(m.jsx)(v.a,{children:Object(m.jsx)(ne.a.Control,{type:"text",defaultValue:c})}),Object(m.jsx)(v.a,{md:1,children:Object(m.jsx)(x.a,{variant:"dark",type:"submit",children:"search"})})]})]})})}),Object(m.jsx)("div",{children:r})]})},oe=Object(O.cn)("MainPage"),ue=function(e){var t=e.classname,r=function(){var e=W(P.REVIEWS,Z,{staleTime:1/0});return{reviews:e.data,isLoading:e.isLoading}}().reviews,n=Object(d.g)(),c=Object(a.useCallback)((function(e){n.push("/reviews/".concat(e,"/read"))}),[n]);return Object(m.jsx)(g,{className:oe(null,[t]),title:"",children:Object(m.jsx)(ie,{children:Object(m.jsx)(j.a,{children:Object(m.jsxs)(D.a,{children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{className:oe("ReviewTitleCol"),children:"Title"}),Object(m.jsx)("th",{className:oe("ReviewLikesCol"),children:"Likes"}),Object(m.jsx)("th",{className:oe("ReviewGradesCol"),children:"Users` grade avg"}),Object(m.jsx)("th",{className:oe("ReviewOpenCol")})]})}),Object(m.jsx)("tbody",{children:r?null===r||void 0===r?void 0:r.map((function(e){return Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{className:oe("ReviewTitleCol"),children:e.tittle}),Object(m.jsxs)("th",{className:oe("ReviewLikesCol"),children:[Object(m.jsx)(re.b,{})," ",e.likesCount]}),Object(m.jsxs)("th",{className:oe("ReviewGradesCol"),children:[Object(m.jsx)(re.c,{})," ",e.usersGradesAvg]}),Object(m.jsx)("th",{className:oe("ReviewOpenCol"),children:Object(m.jsx)(x.a,{variant:"dark",onClick:function(){return c(e.id)},children:"open"})})]},e.id)})):Object(m.jsx)(m.Fragment,{children:"No reviews"})})]})})})})},le=function(e){e.classname;var t=y().setToken,r=Object(d.h)();return Object(a.useEffect)((function(){var e=new URLSearchParams(r.search).get("token");e&&t(e)}),[r.search,t]),Object(m.jsx)(I,{redirectUrl:"/",children:Object(m.jsx)(g,{children:"Redirecting..."})})},de=r(140),je=r(139),be=function(e,t){var r=W([P.REVIEW,Number(e),t],function(e,t){return function(r){return Object(H.a)(B.a.mark((function a(){var c,s,i;return B.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(r){a.next=2;break}return a.abrupt("return");case 2:return a.prev=2,a.next=5,X.a.get("".concat(k,"/api/reviews/").concat(e),{headers:{Authorization:"Bearer ".concat(r)},params:{markdown:t}});case 5:if(c=a.sent,s=c.data,!q(s)){a.next=9;break}return a.abrupt("return",s);case 9:a.next=17;break;case 11:if(a.prev=11,a.t0=a.catch(2),!X.a.isAxiosError(a.t0)){a.next=17;break}if(403!==(null===(i=a.t0.response)||void 0===i?void 0:i.status)){a.next=16;break}throw V.typed(n.NEED_AUTH);case 16:throw a.t0;case 17:throw new Error;case 18:case"end":return a.stop()}}),a,null,[[2,11]])})))}}(Number(e),"edit"===t),{staleTime:1/0});return{review:r.data,isLoading:r.isLoading}},ve=function(e){var t=y(),r=t.token,c=t.setToken;return Object(a.useCallback)(Object(H.a)(B.a.mark((function t(){var a=arguments;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e(r).apply(void 0,a);case 3:return t.abrupt("return",t.sent);case 6:throw t.prev=6,t.t0=t.catch(0),t.t0 instanceof V&&t.t0.type===n.NEED_AUTH&&c(void 0),t.t0;case 10:case"end":return t.stop()}}),t,null,[[0,6]])}))),[e,r,c])},he=function(e){return function(){var t=Object(H.a)(B.a.mark((function t(r){var a,c,s;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,X.a.post("".concat(k,"/api/reviews/").concat(r,"/like"),null,{headers:{Authorization:"Bearer ".concat(e)}});case 5:if(a=t.sent,c=a.data,!q(c)){t.next=9;break}return t.abrupt("return",c);case 9:t.next=17;break;case 11:if(t.prev=11,t.t0=t.catch(2),!X.a.isAxiosError(t.t0)){t.next=17;break}if(403!==(null===(s=t.t0.response)||void 0===s?void 0:s.status)){t.next=16;break}throw V.typed(n.NEED_AUTH);case 16:throw t.t0;case 17:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}()},xe=r(32);!function(e){e.ADD="add",e.UPDATE="update",e.DELETE="delete"}(z||(z={}));var pe=function(e,t,r,n){var a=e.getQueryData(P.ME);if(a)switch(n){case z.DELETE:e.setQueryData(P.ME,Object(R.a)(Object(R.a)({},a),{},{reviews:a.reviews.filter((function(e){return e.id!==r}))}));break;case z.UPDATE:t&&e.setQueryData(P.ME,Object(R.a)(Object(R.a)({},a),{},{reviews:a.reviews.map((function(e){return e.id===r?t:e}))}));break;case z.ADD:t&&e.setQueryData(P.ME,Object(R.a)(Object(R.a)({},a),{},{reviews:[].concat(Object(xe.a)(a.reviews),[t])}))}},Oe=function(e,t,r,n){var a=e.getQueryData(P.REVIEWS),c=a||[];switch(n){case z.ADD:t&&e.setQueryData(P.REVIEWS,[].concat(Object(xe.a)(c),[t]));break;case z.UPDATE:t&&(console.log(t,r),console.log(P.REVIEWS,c.map((function(e){return e.id===r?t:e}))),e.setQueryData(P.REVIEWS,c.map((function(e){return e.id===r?t:e}))));break;case z.DELETE:e.setQueryData(P.REVIEWS,c.filter((function(e){return e.id!==r})))}},fe=function(e){return function(){var t=Object(H.a)(B.a.mark((function t(r,a){var c,s,i;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,X.a.post("".concat(k,"/api/reviews/").concat(r,"/grade"),a,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});case 5:if(c=t.sent,s=c.data,!q(s)){t.next=9;break}return t.abrupt("return",s);case 9:t.next=17;break;case 11:if(t.prev=11,t.t0=t.catch(2),!X.a.isAxiosError(t.t0)){t.next=17;break}if(403!==(null===(i=t.t0.response)||void 0===i?void 0:i.status)){t.next=16;break}throw V.typed(n.NEED_AUTH);case 16:throw t.t0;case 17:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e,r){return t.apply(this,arguments)}}()},me=(r(127),Object(O.cn)("ReviewPageRead")),ge=function(e){var t=e.className,r=Object(d.i)().reviewId,n=ce().me,s=be(r,"read").review,i=Object(d.g)(),o=function(){var e=Object(l.useQueryClient)(),t=ve(he);return Object(a.useCallback)(function(){var r=Object(H.a)(B.a.mark((function r(n){var a;return B.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t(n);case 2:void 0!==(a=r.sent)&&(e.setQueryData([P.REVIEW,n,"read"],a),Oe(e,a,n,z.UPDATE));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),[e,t])}(),u=Object(a.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(t){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}i.push("/signIn"),e.next=6;break;case 4:return e.next=6,o(t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[i,o,n]),h=function(){var e=Object(l.useQueryClient)(),t=ve(fe);return Object(a.useCallback)(function(){var r=Object(H.a)(B.a.mark((function r(n,a){var c;return B.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t(n,a);case 2:void 0!==(c=r.sent)&&(e.setQueryData([P.REVIEW,n,"read"],c),Oe(e,c,n,z.UPDATE));case 4:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}(),[e,t])}(),p=Object(a.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(t,r){return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=4;break}i.push("/signIn"),e.next=6;break;case 4:return e.next=6,h(t,r);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),[h,i,n]);return Object(m.jsx)(g,{className:me(null,[t]),title:"Review - read",children:Object(m.jsx)(ie,{children:Object(m.jsxs)(j.a,{children:[Object(m.jsx)(b.a,{className:"justify-content-md-center",children:Object(m.jsx)("h1",{className:"text-center",children:null===s||void 0===s?void 0:s.tittle})}),Object(m.jsx)(b.a,{className:"justify-content-md-center",children:Object(m.jsx)(v.a,{className:"text-md-center",children:Object(m.jsxs)("h5",{children:["author: ",null===s||void 0===s?void 0:s.author.username,", author's grade: ",null===s||void 0===s?void 0:s.grade," ",Object(m.jsx)(re.c,{})]})})}),Object(m.jsx)(b.a,{className:"justify-content-md-center",children:Object(m.jsx)("div",{dangerouslySetInnerHTML:(null===s||void 0===s?void 0:s.content)?{__html:null===s||void 0===s?void 0:s.content}:void 0})}),Object(m.jsx)(b.a,{className:"justify-content-md-center",children:(null===s||void 0===s?void 0:s.imagesUrls)&&s.imagesUrls.length>0&&Object(m.jsx)(de.a,{children:s.imagesUrls.map((function(e){return Object(m.jsx)(de.a.Item,{children:Object(m.jsx)("img",{style:{width:"100vw",height:"auto"},src:"".concat(e),alt:"Failed to download"})},e)}))})}),Object(m.jsxs)(b.a,{children:["categories: ",null===s||void 0===s?void 0:s.categories.join(", ")]}),Object(m.jsxs)(b.a,{children:["tags: ",null===s||void 0===s?void 0:s.tagsNames.join(", ")]}),Object(m.jsxs)(b.a,{className:"justify-content-between px-3",children:[Object(m.jsx)(v.a,{md:"auto",children:(null===s||void 0===s?void 0:s.author.id)!==(null===n||void 0===n?void 0:n.id)?Object(m.jsxs)(x.a,{variant:"outline-dark",onClick:function(){return u(null===s||void 0===s?void 0:s.id)},children:[Object(m.jsx)(re.b,{className:me("LikeButton",{active:!0})})," ",null===s||void 0===s?void 0:s.likesCount]}):Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(re.b,{className:me("LikeButton")})," ",null===s||void 0===s?void 0:s.likesCount]})}),Object(m.jsx)(v.a,{md:"auto",children:[0,1,2,3,4].map((function(e){return(null===s||void 0===s?void 0:s.author.id)!==(null===n||void 0===n?void 0:n.id)?Object(m.jsx)(x.a,{variant:"outline-dark",onClick:function(){return p(null===s||void 0===s?void 0:s.id,e+1)},children:(null===s||void 0===s?void 0:s.usersGradesAvg)?s.usersGradesAvg<=e?Object(m.jsx)(re.c,{}):s.usersGradesAvg<e+1?Object(m.jsx)(je.a,{}):Object(m.jsx)(re.a,{}):Object(m.jsx)(re.c,{})},e):Object(m.jsx)(c.a.Fragment,{children:(null===s||void 0===s?void 0:s.usersGradesAvg)?s.usersGradesAvg<=e?Object(m.jsx)(re.c,{}):s.usersGradesAvg<e+1?Object(m.jsx)(je.a,{}):Object(m.jsx)(re.a,{}):Object(m.jsx)(re.c,{})},e)}))})]})]})})})},ke=function(e){var t=e.redirectUrl,r=e.children,n=y().token;return Object(m.jsx)(C,{visible:void 0!==n,redirectUrl:t,children:r})},we=Object(O.cn)("MePage"),Ee=function(e){var t=e.className,r=ce().me,n=Object(d.g)(),c=Object(a.useCallback)((function(e){n.push("/reviews/".concat(e,"/edit"))}),[n]),s=Object(a.useCallback)((function(e){n.push("/reviews/".concat(e,"/read"))}),[n]),i=function(){var e=Object(l.useQueryClient)(),t=ve(te);return Object(a.useCallback)(function(){var r=Object(H.a)(B.a.mark((function r(n){return B.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t(n);case 2:void 0!==r.sent&&(Oe(e,null,n,z.DELETE),pe(e,null,n,z.DELETE),e.removeQueries([P.REVIEW,n,"read"]),e.removeQueries([P.REVIEW,n,"edit"]));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),[e,t])}(),o=Object(a.useCallback)((function(e){i(e)}),[i]),u=Object(a.useCallback)((function(){n.push("/me/reviews/create")}),[n]);return Object(m.jsx)(ke,{redirectUrl:"/signIn",children:Object(m.jsx)(g,{className:we(null,[t]),title:"Your profile",children:Object(m.jsx)(ie,{children:Object(m.jsxs)(j.a,{children:[Object(m.jsx)(b.a,{children:Object(m.jsxs)(v.a,{children:[null===r||void 0===r?void 0:r.username," (",null===r||void 0===r?void 0:r.provider,")"]})}),Object(m.jsx)(b.a,{children:Object(m.jsx)(v.a,{children:"Your reviews:"})}),(null===r||void 0===r?void 0:r.reviews)&&r.reviews.length>0?r.reviews.map((function(e){return Object(m.jsxs)(b.a,{className:"mb-1",children:[Object(m.jsx)(v.a,{sm:7,children:e.tittle}),Object(m.jsx)(v.a,{children:Object(m.jsx)(x.a,{variant:"dark",onClick:function(){return s(e.id)},children:"read"})}),Object(m.jsx)(v.a,{children:Object(m.jsx)(x.a,{variant:"dark",onClick:function(){return c(e.id)},children:"edit"})}),Object(m.jsx)(v.a,{children:Object(m.jsx)(x.a,{variant:"dark",onClick:function(){return o(e.id)},children:"delete"})}),Object(m.jsxs)(v.a,{sm:1,children:[Object(m.jsx)(re.b,{})," ",e.likesCount]}),Object(m.jsxs)(v.a,{sm:1,children:[Object(m.jsx)(re.c,{})," ",e.usersGradesAvg]})]},e.id)})):Object(m.jsx)(b.a,{children:Object(m.jsx)(v.a,{children:"You didn`t upload reviews yet"})}),Object(m.jsx)(b.a,{children:Object(m.jsx)(x.a,{variant:"outline-dark",onClick:u,children:"Create new review"})})]})})})})},ye=function(e){return Object(H.a)(B.a.mark((function t(){var r,a,c;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,X.a.get("".concat(k,"/api/reviews/categories"),{headers:{Authorization:"Bearer ".concat(e)}});case 5:if(r=t.sent,a=r.data,!Y(a,J)){t.next=9;break}return t.abrupt("return",a);case 9:t.next=17;break;case 11:if(t.prev=11,t.t0=t.catch(2),!X.a.isAxiosError(t.t0)){t.next=17;break}if(403!==(null===(c=t.t0.response)||void 0===c?void 0:c.status)){t.next=16;break}throw V.typed(n.NEED_AUTH);case 16:throw t.t0;case 17:throw new Error;case 18:case"end":return t.stop()}}),t,null,[[2,11]])})))},Ne=function(){var e=W(P.CATEGORIES,ye,{staleTime:1/0});return{categories:e.data,isLoading:e.isLoading}},Ce=Object(O.cn)("ReviewPage"),Ie=function(e){var t=e.className,r=Object(d.i)().reviewId,n=Object(d.g)(),c=ce().me,s=be(r,"edit").review,i=Ne().categories,o=function(){var e=Object(l.useQueryClient)(),t=ve($);return Object(a.useCallback)(function(){var r=Object(H.a)(B.a.mark((function r(n){var a;return B.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t(n);case 2:return void 0!==(a=r.sent)&&(e.setQueryData([P.REVIEW,a.id,"read"],a),e.removeQueries([P.REVIEW,a.id,"edit"]),Oe(e,a,null,z.UPDATE),pe(e,a,null,z.UPDATE)),r.abrupt("return",a);case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),[e,t])}(),u=Object(a.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(t){var r,a,c,i,u,l,d,j;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),s){e.next=3;break}return e.abrupt("return");case 3:return r=t.currentTarget.elements,a=r.namedItem("tittle").value,c=Number(r.namedItem("grade").value),i=r.namedItem("content").value,u=r.namedItem("tagsNames").value.split(/\s*,\s*/g),l=Object(xe.a)(r.namedItem("categories").values()).map((function(e){return e.checked&&e.value})).filter(Boolean),d=Array.from(r.namedItem("images").files),e.next=12,o({id:s.id,tittle:a,grade:c,content:i,tagsNames:u,categories:l,images:d});case 12:(j=e.sent)&&n.push("/reviews/".concat(null===j||void 0===j?void 0:j.id,"/read"));case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[n,s,o]);return Object(m.jsx)(ke,{redirectUrl:"/signIn",children:Object(m.jsx)(g,{className:Ce(null,[t]),title:"Review - edit",children:Object(m.jsx)(j.a,{children:(null===s||void 0===s?void 0:s.author.id)===(null===c||void 0===c?void 0:c.id)?Object(m.jsxs)(ne.a,{onSubmit:u,children:[Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"tittle",children:[Object(m.jsx)(ne.a.Label,{children:"Tittle"}),Object(m.jsx)(ne.a.Control,{name:"tittle",type:"text",defaultValue:null===s||void 0===s?void 0:s.tittle})]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"grade",children:[Object(m.jsx)(ne.a.Label,{children:"Your grade"}),Object(m.jsxs)(ne.a.Select,{name:"grade",children:[Object(m.jsx)("option",{children:null===s||void 0===s?void 0:s.grade}),(null===s||void 0===s?void 0:s.grade)&&[1,2,3,4,5].map((function(e){return e!==(null===s||void 0===s?void 0:s.grade)&&Object(m.jsx)("option",{value:e,children:e})}))]})]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"content",children:[Object(m.jsx)(ne.a.Label,{children:"Content"}),Object(m.jsx)(ne.a.Control,{name:"content",as:"textarea",rows:20,defaultValue:null===s||void 0===s?void 0:s.content})]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"tagsNames",children:[Object(m.jsx)(ne.a.Label,{children:"Input tags, separated by comma"}),Object(m.jsx)(ne.a.Control,{name:"tags",type:"text",defaultValue:null===s||void 0===s?void 0:s.tagsNames.join(", ")})]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"categories",children:["Categories: ",null===i||void 0===i?void 0:i.map((function(e){return Object(m.jsx)(ne.a.Check,{name:"categories",id:e,label:e,type:"checkbox",inline:!0,defaultChecked:null===s||void 0===s?void 0:s.categories.includes(e),value:e},e)}))]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"images",children:[Object(m.jsx)(ne.a.Label,{children:"Images. Supported formats: JPG, PNG, GIF, BMP, ICO, SVG"}),Object(m.jsx)(ne.a.Control,{name:"images",type:"file",multiple:!0,accept:"image/png"})]}),Object(m.jsx)(x.a,{variant:"dark",type:"submit",children:"Apply changes"})]}):Object(m.jsx)(b.a,{children:Object(m.jsx)(v.a,{children:"You can edit only your reviews"})})})})})},Ae=Object(O.cn)("ReviewPage"),Te=function(e){var t=e.className,r=Object(d.g)(),n=Ne().categories,c=function(){var e=Object(l.useQueryClient)(),t=ve(ee);return Object(a.useCallback)(function(){var r=Object(H.a)(B.a.mark((function r(n){var a;return B.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t(n);case 2:return void 0!==(a=r.sent)&&(e.setQueryData([P.REVIEW,a.id,"read"],a),Oe(e,a,null,z.ADD),pe(e,a,null,z.ADD)),r.abrupt("return",a);case 5:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),[e,t])}(),s=Object(a.useCallback)(function(){var e=Object(H.a)(B.a.mark((function e(t){var n,a,s,i,o,u,l,d;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=t.currentTarget.elements,a=n.namedItem("tittle").value,s=Number(n.namedItem("grade").value),i=n.namedItem("content").value,o=n.namedItem("tagsNames").value.split(/\s*,\s*/g),u=Object(xe.a)(n.namedItem("categories").values()).map((function(e){return e.checked&&e.value})).filter(Boolean),l=Array.from(n.namedItem("images").files),e.next=10,c({tittle:a,grade:s,content:i,tagsNames:o,categories:u,images:l});case 10:(d=e.sent)&&r.push("/reviews/".concat(null===d||void 0===d?void 0:d.id,"/read"));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[c,r]);return Object(m.jsx)(ke,{redirectUrl:"/signIn",children:Object(m.jsx)(g,{className:Ae(null,[t]),title:"Review - create",children:Object(m.jsx)(j.a,{children:Object(m.jsxs)(ne.a,{onSubmit:s,children:[Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"tittle",children:[Object(m.jsx)(ne.a.Label,{children:"Tittle"}),Object(m.jsx)(ne.a.Control,{name:"tittle",type:"text"})]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"grade",children:[Object(m.jsx)(ne.a.Label,{children:"Your grade"}),Object(m.jsx)(ne.a.Select,{name:"grade",children:[1,2,3,4,5].map((function(e){return Object(m.jsx)("option",{value:e,children:e})}))})]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"content",children:[Object(m.jsx)(ne.a.Label,{children:"Content"}),Object(m.jsx)(ne.a.Control,{name:"content",as:"textarea",rows:20})]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"tagsNames",children:[Object(m.jsx)(ne.a.Label,{children:"Input tags, separated by comma"}),Object(m.jsx)(ne.a.Control,{name:"tags",type:"text"})]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"categories",children:["Categories: ",null===n||void 0===n?void 0:n.map((function(e){return Object(m.jsx)(ne.a.Check,{name:"categories",id:e,label:e,type:"checkbox",inline:!0,value:e},e)}))]}),Object(m.jsxs)(ne.a.Group,{className:"mb-3",controlId:"images",children:[Object(m.jsx)(ne.a.Label,{children:"Images. Supported formats: JPG, PNG, GIF, BMP, ICO, SVG"}),Object(m.jsx)(ne.a.Control,{name:"images",type:"file",multiple:!0,accept:"image/png"})]}),Object(m.jsx)(x.a,{variant:"dark",type:"submit",children:"Create review"})]})})})})},De=function(e){var t=Object(l.useQuery)([P.FOUND_REVIEWS,e],function(e){return Object(H.a)(B.a.mark((function t(){var r,n;return B.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,X.a.get("".concat(k,"/api/reviews/search"),{params:{text:e}});case 2:if(r=t.sent,n=r.data,!Y(n,q)){t.next=6;break}return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})))}(e),{retry:!1,staleTime:1/0});return{reviews:t.data,isLoading:t.isLoading}},Re=Object(O.cn)("SearchResult"),Ge=function(e){e.className;var t=Object(d.i)().text,r=De(t||"").reviews,n=Object(d.g)(),c=Object(a.useCallback)((function(e){n.push("/reviews/".concat(e,"/read"))}),[n]);return Object(m.jsx)(g,{title:'Search results for "'.concat(t,'"'),children:Object(m.jsx)(ie,{children:Object(m.jsxs)(D.a,{children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{className:Re("ReviewTitleCol"),children:"Title"}),Object(m.jsx)("th",{className:Re("ReviewLikesCol"),children:"Likes"}),Object(m.jsx)("th",{className:Re("ReviewGradesCol"),children:"Users` grade avg"}),Object(m.jsx)("th",{className:Re("ReviewOpenCol")})]})}),Object(m.jsx)("tbody",{children:r?r.map((function(e){return Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{className:Re("ReviewTitleCol"),children:e.tittle}),Object(m.jsxs)("th",{className:Re("ReviewLikesCol"),children:[Object(m.jsx)(re.b,{})," ",e.likesCount]}),Object(m.jsxs)("th",{className:Re("ReviewGradesCol"),children:[Object(m.jsx)(re.c,{})," ",e.usersGradesAvg]}),Object(m.jsx)("th",{className:Re("ReviewOpenCol"),children:Object(m.jsx)(x.a,{variant:"dark",onClick:function(){return c(e.id)},children:"open"})})]},e.id)})):Object(m.jsx)(m.Fragment,{children:"No reviews"})})]})})})},Ue=Object(m.jsxs)(d.d,{children:[Object(m.jsx)(d.b,{path:"/signIn",exact:!0,children:Object(m.jsx)(T,{})}),Object(m.jsx)(d.b,{path:"/",exact:!0,children:Object(m.jsx)(ue,{})}),Object(m.jsx)(d.b,{path:"/me",exact:!0,children:Object(m.jsx)(Ee,{})}),Object(m.jsx)(d.b,{path:"/redirect",exact:!0,children:Object(m.jsx)(le,{})}),Object(m.jsx)(d.b,{path:"/reviews/:reviewId/read",exact:!0,children:Object(m.jsx)(ge,{})}),Object(m.jsx)(d.b,{path:"/reviews/:reviewId/edit",exact:!0,children:Object(m.jsx)(Ie,{})}),Object(m.jsx)(d.b,{path:"/me/reviews/create",exact:!0,children:Object(m.jsx)(Te,{})}),Object(m.jsx)(d.b,{path:["/reviews/search/result/:text","/reviews/search/result"],children:Object(m.jsx)(Ge,{})})]}),Le=(r(128),function(){return Object(m.jsx)(l.QueryClientProvider,{client:F,children:Object(m.jsx)(N,{children:Object(m.jsx)(u.a,{children:Ue})})})});i.a.render(Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(Le,{})}),document.getElementById("root")),o()},97:function(e,t,r){}},[[129,1,2]]]);
//# sourceMappingURL=main.60f99284.chunk.js.map